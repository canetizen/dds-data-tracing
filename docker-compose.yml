services:
  # tracing-jaeger - Distributed Tracing
  tracing-jaeger:
    image: jaegertracing/all-in-one:1.52
    container_name: tracing-jaeger
    network_mode: host
    environment:
      - COLLECTOR_OTLP_ENABLED=true

  # Command Center Service (CycloneDDS)
  command-center:
    build:
      context: .
      args:
        SERVICE_NAME: command-center
    image: dds-data-tracing/command-center
    container_name: command-center
    network_mode: host
    environment:
      - CYCLONEDDS_URI=file:///shared/cyclonedds.xml
      - TRACED_SERVICE_NAME=command-center
      - OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318/v1/traces
    depends_on:
      - tracing-jaeger
    restart: on-failure

  # Reconnaissance Unit Service (CycloneDDS)
  recon-unit:
    build:
      context: .
      args:
        SERVICE_NAME: recon-unit
    image: dds-data-tracing/recon-unit
    container_name: recon-unit
    network_mode: host
    environment:
      - CYCLONEDDS_URI=file:///shared/cyclonedds.xml
      - TRACED_SERVICE_NAME=recon-unit
      - OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318/v1/traces
    depends_on:
      - tracing-jaeger
      - command-center
    restart: on-failure

  # Logistics Depot Service (CycloneDDS)
  logistics-depot:
    build:
      context: .
      args:
        SERVICE_NAME: logistics-depot
    image: dds-data-tracing/logistics-depot
    container_name: logistics-depot
    network_mode: host
    environment:
      - CYCLONEDDS_URI=file:///shared/cyclonedds.xml
      - TRACED_SERVICE_NAME=logistics-depot
      - OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318/v1/traces
    depends_on:
      - tracing-jaeger
      - recon-unit
    restart: on-failure

  # Tactical Display Service (CycloneDDS)
  tactical-display:
    build:
      context: .
      args:
        SERVICE_NAME: tactical-display
    image: dds-data-tracing/tactical-display
    container_name: tactical-display
    network_mode: host
    environment:
      - CYCLONEDDS_URI=file:///shared/cyclonedds.xml
      - TRACED_SERVICE_NAME=tactical-display
      - OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318/v1/traces
    depends_on:
      - tracing-jaeger
      - logistics-depot
    restart: on-failure
  # ============ Track Fusion System ============

  # Radar Sensor - publishes source tracks
  radar-sensor:
    build:
      context: .
      args:
        SERVICE_NAME: radar-sensor
    image: dds-data-tracing/radar-sensor
    container_name: radar-sensor
    network_mode: host
    environment:
      - CYCLONEDDS_URI=file:///shared/cyclonedds.xml
      - TRACED_SERVICE_NAME=radar-sensor
      - OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318/v1/traces
    depends_on:
      - tracing-jaeger
    restart: on-failure

  # ESM Sensor - publishes source tracks
  esm-sensor:
    build:
      context: .
      args:
        SERVICE_NAME: esm-sensor
    image: dds-data-tracing/esm-sensor
    container_name: esm-sensor
    network_mode: host
    environment:
      - CYCLONEDDS_URI=file:///shared/cyclonedds.xml
      - TRACED_SERVICE_NAME=esm-sensor
      - OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318/v1/traces
    depends_on:
      - tracing-jaeger
    restart: on-failure

  # Optik Sensor - publishes source tracks
  optik-sensor:
    build:
      context: .
      args:
        SERVICE_NAME: optik-sensor
    image: dds-data-tracing/optik-sensor
    container_name: optik-sensor
    network_mode: host
    environment:
      - CYCLONEDDS_URI=file:///shared/cyclonedds.xml
      - TRACED_SERVICE_NAME=optik-sensor
      - OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318/v1/traces
    depends_on:
      - tracing-jaeger
    restart: on-failure

  # Track Fusion - collects source tracks, fuses them, publishes tactical tracks
  track-fusion:
    build:
      context: .
      args:
        SERVICE_NAME: track-fusion
    image: dds-data-tracing/track-fusion
    container_name: track-fusion
    network_mode: host
    environment:
      - CYCLONEDDS_URI=file:///shared/cyclonedds.xml
      - TRACED_SERVICE_NAME=track-fusion
      - OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318/v1/traces
    depends_on:
      - tracing-jaeger
      - radar-sensor
      - esm-sensor
      - optik-sensor
    restart: on-failure

  # Track Consumer - receives tactical tracks
  track-consumer:
    build:
      context: .
      args:
        SERVICE_NAME: track-consumer
    image: dds-data-tracing/track-consumer
    container_name: track-consumer
    network_mode: host
    environment:
      - CYCLONEDDS_URI=file:///shared/cyclonedds.xml
      - TRACED_SERVICE_NAME=track-consumer
      - OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318/v1/traces
    depends_on:
      - tracing-jaeger
      - track-fusion
    restart: on-failure